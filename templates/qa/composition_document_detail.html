{% extends "core/base.html" %}
{% load widget_tweaks %}
{% load staticfiles %}
{% load humanize %}

{% block title %}QA Cleaned Composition Data for Data Document {{ doc.id }}: {{ doc.title }}{% endblock %}

{% block content %}
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url "qa_composition_cleaning_index" %}">Cleaned Composition QA</a></li>
                <li class="breadcrumb-item">
                    <a href="{% url "qa_cleaning_script_detail" script.id %}"> {{ script }} </a>
                </li>
            <li class="breadcrumb-item active" aria-current="page">{{ doc.title }}</li>
        </ol>
    </nav>

    <div class="card">
        <h3 class="card-header">
            <a href="{% url "data_document" doc.pk %}" target="_blank"
               title="Data Document Detail Page">Data Document: {{ doc.title }}</a>
            <a class="btn btn-outline-secondary btn-sm hover-success float-right"
               title="Edit Data Document"
               id="edit_document"
               data-toggle="tooltip"
               href="{% url "data_document_edit" doc.id %}">
                <span class="fa fa-fs fa-edit"></span>
            </a>
        </h3>

        <div class="alert alert-danger" role="alert">
            TODO
          </div>

        <div class="row m-0 border-bottom">
            <div class="col-3 border-right my-auto p-2 font-weight-bold">Data Group</div>
            <div class="col-9 p-2" id="data_group">
                <a title="Data Group"
                   href="{% url "data_group_detail" doc.data_group.id %}"> {{ doc.data_group }}
                </a>
            </div>
        </div>

        <div class="row m-0 border-bottom">
            
        </div>
        <div class="row m-0 border-bottom">
            <div class="col-3 border-right my-auto p-2 font-weight-bold">Subtitle</div>
            <div class="col-9 p-2" id="subtitle">
                {{ doc.subtitle }}
            </div>
        </div>

        <div class="row m-0 border-bottom">
            <div class="col-3 border-right my-auto p-2 font-weight-bold">Raw Category</div>
            <div class="col-9 p-2" id="raw_category">
                {{ doc.raw_category }}
            </div>
        </div>

        <div class="row m-0 border-bottom">
            <div class="col-3 border-right my-auto p-2 font-weight-bold">URL</div>
            <div class="col-9 p-2" id="url">
                {{ doc.url }}
            </div>
        </div>

        <div class="row m-0 border-bottom">
            <div class="col-3 border-right my-auto p-2 font-weight-bold">Note</div>
            <div class="col-9 p-2" id="note">
                {{ doc.note }}
            </div>
        </div>

        {% if doc.matched %}
            <div class="row m-0 border-bottom">
                <div class="col-3 border-right my-auto p-2 font-weight-bold">PDF</div>
                <div class="col-9 p-1 pl-2" id="pdf">
                    <a class="btn btn-sm btn-outline-secondary hover-info"
                       role="button"
                       title="{{ doc.filename }}"
                       download="{{ doc.filename }}"
                       target="_blank"
                       href="{{ doc.file.url }}">
                        <span class="fa fa-fs {{ doc.filename|fileicon }}"></span>
                    </a>
                    <small><i>Click the icon to download PDF. Click
                        <a target="_blank" title="{{ doc.filename }}" href="{{ doc.file.url }}">here</a>
                        to open link in new window.</i></small>
                </div>
            </div>
        {% endif %}

        <div class="row m-0 border-bottom">
            
        </div>
    </div>

    <div class="card">
        <h3 class="card-header">
            Extracted Text
            <a class="btn btn-outline-secondary btn-sm hover-success float-right"
               title="Edit Extracted Text"
               id="btn-edit-extracted-text"
               data-toggle="modal"
               data-target="#extextModal">
                <span class="fa fa-fs fa-edit"></span>
            </a>
        </h3>
        {% for field in ext_form.visible_fields %}
            <div class="row m-0 border-bottom">
                <div class="col-3 p-2 border-right my-auto font-weight-bold">{{ field.label }}</div>
                <div class="col-9 p-2" id="{{ field.id_for_label }}">
                    {% if field.id_for_label == "id_study_type" and field.value %}
                        {{ extracted_text.get_study_type_display }}
                    {% elif field.value %}
                        {{ field.value }}
                    {% else %}
                        <small class="pl-3 pr-3">
                            <i class="text-muted">
                                ...No value
                            </i>
                        </small>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
        {% include "forms/extracted_text_modal.html" with form=ext_form colspan="col-8" %}
    </div>

    <div class="card">
        <h3 class="card-header">
            {{ doc.data_group.group_type }} Records
        </h3>
        <div id="card-panel" class="card-body">
            {{ cards | safe }}
        </div>
        </div>

    <div class="card">
        <h3 class="card-header">QA Review</h3>
        <div class="row card-body">
 

            
        </div>
        <p class="card-footer"> </p>
    </div>
{% endblock %}

{% block js %}
    {{ doc.id|json_script:"doc" }}
    <script src="{% static 'bootstrap-slider/bootstrap-slider.min.js' %}"></script>
    <script src="{% static "js/dashboard/qa_extracted_text.js" %}"></script>
    <script type="text/javascript" src="{% static 'js/dashboard/datadocument_detail_card_selector.js' %}"></script>
    <script type="module" src="{% static 'js/dashboard/datadocument_detail_ajax.js' %}"></script>
    <script src="{% static 'js/jquery.form.js' %}"></script>
{% endblock %}

{% block css %}
    <link rel="stylesheet" href="{% static 'bootstrap-slider/css/bootstrap-slider.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/bootstrap_slider_overrides.css' %}">
{% endblock %}

